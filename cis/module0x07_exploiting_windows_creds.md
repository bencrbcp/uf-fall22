# MODULE 0x070 LECTURE 0x1e0 - KERBEROS GOLDEN AND SILVER TICKETS

## Kerberos

The Sad Fact:

"One time I had to explain Kerberos to someone.
Then we both didn't understand it."


* Where can I find more about this?
    - [Kerberos in the Crosshairs article](https://www.sans.org/blog/kerberos-in-the-crosshairs-golden-tickets-silver-tickets-mitm-and-more/) by Mike Pilkington


## Kerberos Concept

The Key Distribution Center (KDC) is a trusted third party (a _Domain Controller_ in the Microsoft implementation)

* To use a service, a user requests a **service ticket** from the KDC.
    - This is unique to the user and describes the service.
    - Contained in a _Privileged Attribute Certificate (PAC)_

* [ADsecurity.org](https://adsecurity.org/?page_id=183) has a comprehensive list of services employed by AD
    - Exmaples include IPP (printing), MongoDB, IMAP, SMTP, CIFS, RDP, RPC...
    - Q: To be clear, when you request a service ticket, you're requesting a service on another host in the Active Directory domain, NOT a host on the domain controller itself?

* The ticket and the set of temporary encryption keys are given to the user __and__ the service.
    - This allows the client to verify the server and the server to verify the client.
    - Client and server use keys to authenticate and to encrypt communications.


## Using Kerberos

1. Authentication service request
    - User contacts KDC's authentication service to ask for a special Ticket-Granting-Ticket (TGT)
    - This is done by encrypting current timestamp with a client __long-term key.__
    - The TGT allows you to _get a ticket,_ confirms who you really are (authentication)

* To exploit this, attacker uses the simplest encryption scheme (RC4)...
    - ...in which case, the user's password hash is employed as the long-term key.
    - All other encryption keys must be removed from memory to ensure this will work (there are processes for doing this).
    - In other words, if you have the user's RC4 password hash, then you can pretend to be the user.
    - Benjamin Delpy (mimikatz creator) calls this overpass-the-hash because the TGT can provide access to __all Kerberos services.__

2.

#### Sidenote on Mimikatz
"Mimikatz is both an exploit on Microsoft Windows that extracts passwords stored in memory and software that performs that exploit"

"Mimikatz is an open-source application that allows users to view and save authentication credentials such as Kerberos tickets. The toolset works with the current release of Windows and includes a collection of different network attacks to help assess vulnerabilities.

Attackers commonly use Mimikatz to steal credentials and escalate privileges because in most cases, endpoint protection software and antivirus systems will not detect or delete the attack. Conversely, pen testers use Mimikatz to detect and exploit vulnerabilities in your networks so you can fix them."
